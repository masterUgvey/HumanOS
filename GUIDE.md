# HumanOS — Руководство

Актуальная инструкция по установке, запуску и использованию бота.

## Установка
- Python 3.10+
- Создайте и активируйте venv (по желанию)
- Установите зависимости:
  - `pip install -r requirements.txt`
- Настройте .env (скопируйте из .env.example при необходимости):
  - `TELEGRAM_TOKEN=...`
  - `WINDSURF_API_KEY=...` (опционально)
  - `DB_PATH=quests.db` (по умолчанию)

## Запуск
- `python main.py`
- При старте бот инициализирует БД и готов к работе.

## Основные команды
- `➕ Создать квест` — создание квеста через пошаговый диалог
- `/progress` — сводка прогресса
- `/sanitize` — сервисная чистка БД (см. ниже)

## Создание квеста — поведение даты и комментария
- Кнопка «Сегодня» устанавливает дедлайн как локальную дату в формате `YYYY-MM-DD 00:00:00`.
- Ручной ввод даты:
  - `ДД.ММ.ГГ` → сохраняется как `YYYY-MM-DD 00:00:00` (без времени)
  - `ДД.ММ.ГГ ЧЧ:ММ` → сохраняется как `YYYY-MM-DD HH:MM`
  - Прошедшие даты/время запрещены (проверка по локальному времени)
- Отображение дедлайна в карточке:
  - Нет дедлайна → «без даты и времени»
  - `00:00:00` → «ДД.ММ.ГГ (без времени)»
  - Есть время → «ДД.ММ.ГГ ЧЧ:ММ»
- Комментарий:
  - Если пользователь отправил строку, похожую на дату, или равную дедлайну — комментарий не сохраняется (аналог «Пропустить»)

## Чистка базы данных
- Команда `/sanitize` приводит БД в порядок:
  - Очищает датоподобные комментарии и совпадающие с дедлайном
  - Нормализует дедлайны вида `YYYY-MM-DD` → `YYYY-MM-DD 00:00:00`
  - Исправляет случаи «вчера + время» (по `created_at`) → `дата создания 00:00:00`

## Диагностика
Логи помечены тегами:
- `[CREATE] set_deadline_today|parse_deadline|comment|create_quest`
- `[DB] create_quest normalized|update_quest`
- `[DETAIL] open quest_id=...` — открытие карточки

## Частые вопросы
- Почему дата без времени не сдвигается? — Мы сохраняем «дату без времени» как `00:00:00` и отображаем «(без времени)», что исключает смещения между часовыми поясами и сервером/клиентом.
- Можно ли вводить дату в формате `YYYY-MM-DD`? — Для ручного ввода поддерживаются `ДД.ММ.ГГ` и `ДД.ММ.ГГ ЧЧ:ММ`. Кнопка «Сегодня» выставляет дату автоматически.
